/*
 * imgAreaSelect jQuery plugin
 * version 0.9.10
 *
 * Copyright (c) 2008-2013 Michal Wojciechowski (odyniec.net)
 *
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 *
 * http://odyniec.net/projects/imgareaselect/
 *
 */
!function(e){function t(){return e("<div/>")}var o=Math.abs,n=Math.max,i=Math.min,s=Math.round;e.imgAreaSelect=function(r,a){function c(e){return e+ge.left-be.left}function d(e){return e+ge.top-be.top}function u(e){return e-ge.left+be.left}function l(e){return e-ge.top+be.top}function f(e){return e.pageX-be.left}function h(e){return e.pageY-be.top}function m(e){var t=e||O,o=e||q;return{x1:s(xe.x1*t),y1:s(xe.y1*o),x2:s(xe.x2*t),y2:s(xe.y2*o),width:s(xe.x2*t)-s(xe.x1*t),height:s(xe.y2*o)-s(xe.y1*o)}}function p(e,t,o,n,i){var r=i||O,a=i||q;(xe={x1:s(e/r||0),y1:s(t/a||0),x2:s(o/r||0),y2:s(n/a||0)}).width=xe.x2-xe.x1,xe.height=xe.y2-xe.y1}function g(){K&&ue.width()&&(ge={left:s(ue.offset().left),top:s(ue.offset().top)},X=ue.innerWidth(),j=ue.innerHeight(),ge.top+=ue.outerHeight()-j>>1,ge.left+=ue.outerWidth()-X>>1,Q=s(a.minWidth/O)||0,V=s(a.minHeight/q)||0,_=s(i(a.maxWidth/O||1<<24,X)),F=s(i(a.maxHeight/q||1<<24,j)),"1.3.2"!=e().jquery||"fixed"!=ve||we.getBoundingClientRect||(ge.top+=n(document.body.scrollTop,we.scrollTop),ge.left+=n(document.body.scrollLeft,we.scrollLeft)),be=/absolute|relative/.test(E.css("position"))?{left:s(E.offset().left)-E.scrollLeft(),top:s(E.offset().top)-E.scrollTop()}:"fixed"==ve?{left:e(document).scrollLeft(),top:e(document).scrollTop()}:{left:0,top:0},B=c(0),N=d(0),(xe.x2>X||xe.y2>j)&&M())}function b(t){if(U){switch(le.css({left:c(xe.x1),top:d(xe.y1)}).add(fe).width(ae=xe.width).height(ce=xe.height),fe.add(he).add(pe).css({left:0,top:0}),he.width(n(ae-he.outerWidth()+he.innerWidth(),0)).height(n(ce-he.outerHeight()+he.innerHeight(),0)),e(me[0]).css({left:B,top:N,width:xe.x1,height:j}),e(me[1]).css({left:B+xe.x1,top:N,width:ae,height:xe.y1}),e(me[2]).css({left:B+xe.x2,top:N,width:X-xe.x2,height:j}),e(me[3]).css({left:B+xe.x1,top:N+xe.y2,width:ae,height:j-xe.y2}),ae-=pe.outerWidth(),ce-=pe.outerHeight(),pe.length){case 8:e(pe[4]).css({left:ae>>1}),e(pe[5]).css({left:ae,top:ce>>1}),e(pe[6]).css({left:ae>>1,top:ce}),e(pe[7]).css({top:ce>>1});case 4:pe.slice(1,3).css({left:ae}),pe.slice(2,4).css({top:ce})}!1!==t&&(e.imgAreaSelect.onKeyPress!=ke&&e(document).unbind(e.imgAreaSelect.keyPress,e.imgAreaSelect.onKeyPress),a.keys&&e(document)[e.imgAreaSelect.keyPress](e.imgAreaSelect.onKeyPress=ke)),Me&&he.outerWidth()-he.innerWidth()==2&&(he.css("margin",0),setTimeout(function(){he.css("margin","auto")},0))}}function y(e){g(),b(e),Z=c(xe.x1),ee=d(xe.y1),te=c(xe.x2),oe=d(xe.y2)}function v(e,t){a.fadeSpeed?e.fadeOut(a.fadeSpeed,t):e.hide()}function x(e){var t=u(f(e))-xe.x1,o=l(h(e))-xe.y1;de||(g(),de=!0,le.one("mouseout",function(){de=!1})),Y="",a.resizable&&(o<=a.resizeMargin?Y="n":o>=xe.height-a.resizeMargin&&(Y="s"),t<=a.resizeMargin?Y+="w":t>=xe.width-a.resizeMargin&&(Y+="e")),le.css("cursor",Y?Y+"-resize":a.movable?"move":""),R&&R.toggle()}function w(){e("body").css("cursor",""),(a.autoHide||xe.width*xe.height==0)&&v(le.add(me),function(){e(this).hide()}),e(document).unbind("mousemove",z),le.mousemove(x),a.onSelectEnd(r,m())}function S(t){return 1==t.which&&(g(),Y?(e("body").css("cursor",Y+"-resize"),Z=c(xe[/w/.test(Y)?"x2":"x1"]),ee=d(xe[/n/.test(Y)?"y2":"y1"]),e(document).mousemove(z).one("mouseup",w),le.unbind("mousemove",x)):a.movable?(G=B+xe.x1-f(t),D=N+xe.y1-h(t),le.unbind("mousemove",x),e(document).mousemove(I).one("mouseup",function(){a.onSelectEnd(r,m()),e(document).unbind("mousemove",I),le.mousemove(x)})):ue.mousedown(t),!1)}function k(e){J&&(e?(te=n(B,i(B+X,Z+o(oe-ee)*J*(te>Z||-1))),oe=s(n(N,i(N+j,ee+o(te-Z)/J*(oe>ee||-1)))),te=s(te)):(oe=n(N,i(N+j,ee+o(te-Z)/J*(oe>ee||-1))),te=s(n(B,i(B+X,Z+o(oe-ee)*J*(te>Z||-1)))),oe=s(oe)))}function M(){Z=i(Z,B+X),ee=i(ee,N+j),o(te-Z)<Q&&((te=Z-Q*(te<Z||-1))<B?Z=B+Q:te>B+X&&(Z=B+X-Q)),o(oe-ee)<V&&((oe=ee-V*(oe<ee||-1))<N?ee=N+V:oe>N+j&&(ee=N+j-V)),te=n(B,i(te,B+X)),oe=n(N,i(oe,N+j)),k(o(te-Z)<o(oe-ee)*J),o(te-Z)>_&&(te=Z-_*(te<Z||-1),k()),o(oe-ee)>F&&(oe=ee-F*(oe<ee||-1),k(!0)),xe={x1:u(i(Z,te)),x2:u(n(Z,te)),y1:l(i(ee,oe)),y2:l(n(ee,oe)),width:o(te-Z),height:o(oe-ee)},b(),a.onSelectChange(r,m())}function z(e){return te=/w|e|^$/.test(Y)||J?f(e):c(xe.x2),oe=/n|s|^$/.test(Y)||J?h(e):d(xe.y2),M(),!1}function C(t,o){te=(Z=t)+xe.width,oe=(ee=o)+xe.height,e.extend(xe,{x1:u(Z),y1:l(ee),x2:u(te),y2:l(oe)}),b(),a.onSelectChange(r,m())}function I(e){return Z=n(B,i(G+f(e),B+X-xe.width)),ee=n(N,i(D+h(e),N+j-xe.height)),C(Z,ee),e.preventDefault(),!1}function T(){e(document).unbind("mousemove",T),g(),te=Z,oe=ee,M(),Y="",me.is(":visible")||le.add(me).hide().fadeIn(a.fadeSpeed||0),U=!0,e(document).unbind("mouseup",$).mousemove(z).one("mouseup",w),le.unbind("mousemove",x),a.onSelectStart(r,m())}function $(){e(document).unbind("mousemove",T).unbind("mouseup",$),v(le.add(me)),p(u(Z),l(ee),u(Z),l(ee)),this instanceof e.imgAreaSelect||(a.onSelectChange(r,m()),a.onSelectEnd(r,m()))}function P(t){return 1==t.which&&!me.is(":animated")&&(g(),G=Z=f(t),D=ee=h(t),e(document).mousemove(T).mouseup($),!1)}function A(){y(!1)}function H(){K=!0,W(a=e.extend({classPrefix:"imgareaselect",movable:!0,parent:"body",resizable:!0,resizeMargin:10,onInit:function(){},onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){}},a)),le.add(me).css({visibility:""}),a.show&&(U=!0,g(),b(),le.add(me).hide().fadeIn(a.fadeSpeed||0)),setTimeout(function(){a.onInit(r,m())},0)}function L(e,t){for(var o in t)a[o]!==undefined&&e.css(t[o],a[o])}function W(o){if(o.parent&&(E=e(o.parent)).append(le.add(me)),e.extend(a,o),g(),null!=o.handles){for(pe.remove(),pe=e([]),se=o.handles?"corners"==o.handles?4:8:0;se--;)pe=pe.add(t());pe.addClass(a.classPrefix+"-handle").css({position:"absolute",fontSize:0,zIndex:ye+1||1}),!parseInt(pe.css("width"))>=0&&pe.width(5).height(5),(re=a.borderWidth)&&pe.css({borderWidth:re,borderStyle:"solid"}),L(pe,{borderColor1:"border-color",borderColor2:"background-color",borderOpacity:"opacity"})}for(O=a.imageWidth/X||1,q=a.imageHeight/j||1,null!=o.x1&&(p(o.x1,o.y1,o.x2,o.y2),o.show=!o.hide),o.keys&&(a.keys=e.extend({shift:1,ctrl:"resize"},o.keys)),me.addClass(a.classPrefix+"-outer"),fe.addClass(a.classPrefix+"-selection"),se=0;se++<4;)e(he[se-1]).addClass(a.classPrefix+"-border"+se);L(fe,{selectionColor:"background-color",selectionOpacity:"opacity"}),L(he,{borderOpacity:"opacity",borderWidth:"border-width"}),L(me,{outerColor:"background-color",outerOpacity:"opacity"}),(re=a.borderColor1)&&e(he[0]).css({borderStyle:"solid",borderColor:re}),(re=a.borderColor2)&&e(he[1]).css({borderStyle:"dashed",borderColor:re}),le.append(fe.add(he).add(R)).append(pe),Me&&((re=(me.css("filter")||"").match(/opacity=(\d+)/))&&me.css("opacity",re[1]/100),(re=(he.css("filter")||"").match(/opacity=(\d+)/))&&he.css("opacity",re[1]/100)),o.hide?v(le.add(me)):o.show&&K&&(U=!0,le.add(me).fadeIn(a.fadeSpeed||0),y()),J=(ie=(a.aspectRatio||"").split(/:/))[0]/ie[1],ue.add(me).unbind("mousedown",P),a.disable||!1===a.enable?(le.unbind("mousemove",x).unbind("mousedown",S),e(window).unbind("resize",A)):((a.enable||!1===a.disable)&&((a.resizable||a.movable)&&le.mousemove(x).mousedown(S),e(window).resize(A)),a.persistent||ue.add(me).mousedown(P)),a.enable=a.disable=undefined}var K,R,B,N,X,j,E,G,D,O,q,Y,Q,V,_,F,J,U,Z,ee,te,oe,ne,ie,se,re,ae,ce,de,ue=e(r),le=t(),fe=t(),he=t().add(t()).add(t()).add(t()),me=t().add(t()).add(t()).add(t()),pe=e([]),ge={left:0,top:0},be={left:0,top:0},ye=0,ve="absolute",xe={x1:0,y1:0,x2:0,y2:0,width:0,height:0},we=document.documentElement,Se=navigator.userAgent,ke=function(e){var t,o,s=a.keys,r=e.keyCode;if(t=isNaN(s.alt)||!e.altKey&&!e.originalEvent.altKey?!isNaN(s.ctrl)&&e.ctrlKey?s.ctrl:!isNaN(s.shift)&&e.shiftKey?s.shift:isNaN(s.arrows)?10:s.arrows:s.alt,"resize"==s.arrows||"resize"==s.shift&&e.shiftKey||"resize"==s.ctrl&&e.ctrlKey||"resize"==s.alt&&(e.altKey||e.originalEvent.altKey)){switch(r){case 37:t=-t;case 39:o=n(Z,te),Z=i(Z,te),te=n(o+t,Z),k();break;case 38:t=-t;case 40:o=n(ee,oe),ee=i(ee,oe),oe=n(o+t,ee),k(!0);break;default:return}M()}else switch(Z=i(Z,te),ee=i(ee,oe),r){case 37:C(n(Z-t,B),ee);break;case 38:C(Z,n(ee-t,N));break;case 39:C(Z+i(t,X-u(te)),ee);break;case 40:C(Z,ee+i(t,j-l(oe)));break;default:return}return!1};this.remove=function(){W({disable:!0}),le.add(me).remove()},this.getOptions=function(){return a},this.setOptions=W,this.getSelection=m,this.setSelection=p,this.cancelSelection=$,this.update=y;var Me=(/msie ([\w.]+)/i.exec(Se)||[])[1],ze=/opera/i.test(Se),Ce=/webkit/i.test(Se)&&!/chrome/i.test(Se);for(ne=ue;ne.length;)ye=n(ye,isNaN(ne.css("z-index"))?ye:ne.css("z-index")),"fixed"==ne.css("position")&&(ve="fixed"),ne=ne.parent(":not(body)");ye=a.zIndex||ye,Me&&ue.attr("unselectable","on"),e.imgAreaSelect.keyPress=Me||Ce?"keydown":"keypress",ze&&(R=t().css({width:"100%",height:"100%",position:"absolute",zIndex:ye+2||2})),le.add(me).css({visibility:"hidden",position:ve,overflow:"hidden",zIndex:ye||"0"}),le.css({zIndex:ye+2||2}),fe.add(he).css({position:"absolute",fontSize:0}),r.complete||"complete"==r.readyState||!ue.is("img")?H():ue.one("load",H),!K&&Me&&Me>=7&&(r.src=r.src)},e.fn.imgAreaSelect=function(t){return t=t||{},this.each(function(){e(this).data("imgAreaSelect")?t.remove?(e(this).data("imgAreaSelect").remove(),e(this).removeData("imgAreaSelect")):e(this).data("imgAreaSelect").setOptions(t):t.remove||(t.enable===undefined&&t.disable===undefined&&(t.enable=!0),e(this).data("imgAreaSelect",new e.imgAreaSelect(this,t)))}),t.instance?e(this).data("imgAreaSelect"):this}}(jQuery),jQuery.fn.farbtastic=function(e){return $.farbtastic(this,e),this},jQuery.farbtastic=function(e,t){return(e=$(e).get(0)).farbtastic||(e.farbtastic=new jQuery._farbtastic(e,t))},jQuery._farbtastic=function(e,t){var o=this;$(e).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var n=$(".farbtastic",e);o.wheel=$(".wheel",e).get(0),o.radius=84,o.square=100,o.width=194,navigator.appVersion.match(/MSIE [0-6]\./)&&$("*",n).each(function(){if("none"!=this.currentStyle.backgroundImage){var e=this.currentStyle.backgroundImage;e=this.currentStyle.backgroundImage.substring(5,e.length-2),$(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+e+"')"})}}),o.linkTo=function(e){return"object"==typeof o.callback&&$(o.callback).unbind("keyup",o.updateValue),o.color=null,"function"==typeof e?o.callback=e:"object"!=typeof e&&"string"!=typeof e||(o.callback=$(e),o.callback.bind("keyup",o.updateValue),o.callback.get(0).value&&o.setColor(o.callback.get(0).value)),this},o.updateValue=function(){this.value&&this.value!=o.color&&o.setColor(this.value)},o.setColor=function(e){var t=o.unpack(e);return o.color!=e&&t&&(o.color=e,o.rgb=t,o.hsl=o.RGBToHSL(o.rgb),o.updateDisplay()),this},o.setHSL=function(e){return o.hsl=e,o.rgb=o.HSLToRGB(e),o.color=o.pack(o.rgb),o.updateDisplay(),this},o.widgetCoords=function(e){var t,n,i=e.target||e.srcElement,s=o.wheel;if("undefined"!=typeof e.offsetX){for(var r={x:e.offsetX,y:e.offsetY},a=i;a;)a.mouseX=r.x,a.mouseY=r.y,r.x+=a.offsetLeft,r.y+=a.offsetTop,a=a.offsetParent;a=s;for(var c={x:0,y:0};a;){if("undefined"!=typeof a.mouseX){t=a.mouseX-c.x,n=a.mouseY-c.y;break}c.x+=a.offsetLeft,c.y+=a.offsetTop,a=a.offsetParent}for(a=i;a;)a.mouseX=undefined,a.mouseY=undefined,a=a.offsetParent}else{r=o.absolutePosition(s);t=(e.pageX||0*(e.clientX+$("html").get(0).scrollLeft))-r.x,n=(e.pageY||0*(e.clientY+$("html").get(0).scrollTop))-r.y}return{x:t-o.width/2,y:n-o.width/2}},o.mousedown=function(e){document.dragging||($(document).bind("mousemove",o.mousemove).bind("mouseup",o.mouseup),document.dragging=!0);var t=o.widgetCoords(e);return o.circleDrag=2*Math.max(Math.abs(t.x),Math.abs(t.y))>o.square,o.mousemove(e),!1},o.mousemove=function(e){var t=o.widgetCoords(e);if(o.circleDrag){var n=Math.atan2(t.x,-t.y)/6.28;n<0&&(n+=1),o.setHSL([n,o.hsl[1],o.hsl[2]])}else{var i=Math.max(0,Math.min(1,-t.x/o.square+.5)),s=Math.max(0,Math.min(1,-t.y/o.square+.5));o.setHSL([o.hsl[0],i,s])}return!1},o.mouseup=function(){$(document).unbind("mousemove",o.mousemove),$(document).unbind("mouseup",o.mouseup),document.dragging=!1},o.updateDisplay=function(){var e=6.28*o.hsl[0];$(".h-marker",n).css({left:Math.round(Math.sin(e)*o.radius+o.width/2)+"px",top:Math.round(-Math.cos(e)*o.radius+o.width/2)+"px"}),$(".sl-marker",n).css({left:Math.round(o.square*(.5-o.hsl[1])+o.width/2)+"px",top:Math.round(o.square*(.5-o.hsl[2])+o.width/2)+"px"}),$(".color",n).css("backgroundColor",o.pack(o.HSLToRGB([o.hsl[0],1,.5]))),"object"==typeof o.callback?($(o.callback).css({backgroundColor:o.color,color:o.hsl[2]>.5?"#000":"#fff"}),$(o.callback).each(function(){this.value&&this.value!=o.color&&(this.value=o.color)})):"function"==typeof o.callback&&o.callback.call(o,o.color)},o.absolutePosition=function(e){var t={x:e.offsetLeft,y:e.offsetTop};if(e.offsetParent){var n=o.absolutePosition(e.offsetParent);t.x+=n.x,t.y+=n.y}return t},o.pack=function(e){var t=Math.round(255*e[0]),o=Math.round(255*e[1]),n=Math.round(255*e[2]);return"#"+(t<16?"0":"")+t.toString(16)+(o<16?"0":"")+o.toString(16)+(n<16?"0":"")+n.toString(16)},o.unpack=function(e){return 7==e.length?[parseInt("0x"+e.substring(1,3))/255,parseInt("0x"+e.substring(3,5))/255,parseInt("0x"+e.substring(5,7))/255]:4==e.length?[parseInt("0x"+e.substring(1,2))/15,parseInt("0x"+e.substring(2,3))/15,parseInt("0x"+e.substring(3,4))/15]:void 0},o.HSLToRGB=function(e){var t,o,n=e[0],i=e[1],s=e[2];return t=2*s-(o=s<=.5?s*(i+1):s+i-s*i),[this.hueToRGB(t,o,n+.33333),this.hueToRGB(t,o,n),this.hueToRGB(t,o,n-.33333)]},o.hueToRGB=function(e,t,o){return 6*(o=o<0?o+1:o>1?o-1:o)<1?e+(t-e)*o*6:2*o<1?t:3*o<2?e+(t-e)*(.66666-o)*6:e},o.RGBToHSL=function(e){var t,o,n,i,s,r,a=e[0],c=e[1],d=e[2];return t=Math.min(a,Math.min(c,d)),n=(o=Math.max(a,Math.max(c,d)))-t,s=0,(r=(t+o)/2)>0&&r<1&&(s=n/(r<.5?2*r:2-2*r)),i=0,n>0&&(o==a&&o!=c&&(i+=(c-d)/n),o==c&&o!=d&&(i+=2+(d-a)/n),o==d&&o!=a&&(i+=4+(a-c)/n),i/=6),[i,s,r]},$("*",n).mousedown(o.mousedown),o.setColor("#000000"),t&&o.linkTo(t)};